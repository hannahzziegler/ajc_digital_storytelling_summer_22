---
title: "lasers"
output: html_document
date: '2022-06-23'
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Load Packages & Data

```{r}

library(tidyverse)
library(janitor)
library(tidycensus)
library(ggplot2)
library(sf)

lasers_2022 <- read_csv("Lasers_2022_05_31.csv")

lasers_2021 <- read_csv("Lasers_2021.csv")

lasers_2020 <- read_csv("Lasers_2020.csv") 

lasers_2019_mess <- read_csv("Lasers_2019.csv") 

lasers_2019 <- lasers_2019_mess %>%
  select(`Incident Time`, `Incident Date`, `Flight ID`, Aircraft, Altitude, Airport, `Laser Color`, Injury, City, State)

```

## Summing just Georgia

```{r}

georgia_lasers_2022 <- lasers_2022 %>%
  filter(State == "Georgia")

count_2022 <- georgia_lasers_2022 %>%
  summarise(count = n())

georgia_lasers_2021 <- lasers_2021 %>%
  filter(State == "Georgia")

count_2021 <- georgia_lasers_2021 %>%
  summarise(count = n())

georgia_lasers_2020 <- lasers_2020 %>%
  filter(State == "Georgia")
  
georgia_lasers_2020 <- georgia_lasers_2020[-c(109), ]

count_2020 <- georgia_lasers_2020 %>%
  summarise(count = n())

georgia_lasers_2019 <- lasers_2019 %>%
  filter(State == "Georgia")

count_2019 <- georgia_lasers_2019 %>%
  summarise(count = n())

georgia_lasers_4_years_1 <- count_2019 %>% left_join(count_2020, by=c("count"))

```

## Georgia city-by-city Breakdown

```{r}

georgia_city_summary_lasers_2022 <- georgia_lasers_2022 %>%
  group_by(City) %>%
  summarise(count_2022 = n()) %>%
  arrange(desc(count_2022))

georgia_lasers_2021 <- lasers_2021 %>%
  filter(State == "Georgia")

georgia_city_summary_lasers_2021 <- georgia_lasers_2021 %>%
  group_by(City) %>%
  summarise(count_2021 = n()) %>%
  arrange(desc(count_2021))

georgia_city_summary_lasers_2020 <- georgia_lasers_2020 %>%
  group_by(City) %>%
  summarise(count_2020 = n()) %>%
  arrange(desc(count_2020))

georgia_city_summary_lasers_2019 <- georgia_lasers_2019 %>%
  group_by(City) %>%
  summarise(count_2019 = n()) %>%
  arrange(desc(count_2019))

georgia_city_summary_four_years <- georgia_city_summary_lasers_2019 %>% left_join(georgia_city_summary_lasers_2020, by=c("City"))

georgia_city_summary_four_years_2 <- georgia_city_summary_four_years %>% left_join(georgia_city_summary_lasers_2021, by=c("City"))

final_georgia_city_summary_four_years <- georgia_city_summary_four_years_2 %>% left_join(georgia_city_summary_lasers_2022, by=c("City"))

final_georgia_city_summary_four_years[is.na(final_georgia_city_summary_four_years)] <- 0
  
```

## Let's put the rest in Excel for timeliness + export the rest!

```{r}

georgia_lasers_2022 %>%
  group_by(City) %>%
  summarize(count = n()) %>%
  arrange(desc(count))

write_csv(final_georgia_city_summary_four_years,"georgia_city_plane_laser_breakdown.csv")

```


## So now we are going to do a month-by-month breakdown of the lasers to see if Georgia is on pace to surpass last year.

```{r}

library(lubridate)

fixed_date <- read_csv("Lasers_2021.csv")

ga_final_2021 <- fixed_date %>%
  filter(State == "Georgia")

mdy_ga <- ga_final_2021 %>%
  separate(incident_date, sep="/", into = c("month", "day", "year"))

month_groups <- mdy_ga %>%
  group_by(month) %>%
  summarize(count = n())

write_csv(month_groups,"month_by_month_2021.csv")

fixed_2022_date <- read_csv("Lasers_2022_05_31.csv")

ga_final_2022 <- fixed_2022_date %>%
  separate(incident_date, sep="/", into = c("month", "day", "year")) %>%
  filter(State == "Georgia") %>%
  group_by(month) %>%
  summarize(count = n())

write_csv(ga_final_2022,"month_by_month_2022.csv")

```

## Work on Thursday 6/30

## We need to do the same thing with the dates for the 2019 and 2020 data in order to make a graph that shows all four years and a month-by-month visualization of how they compare to one another -- Friday task 

```{r}

fixing_2019_dates <- georgia_lasers_2019 %>%
  clean_names()

fixing_2019_dates <- fixing_2019_dates %>%
  separate(incident_date, sep="-", into = c("day", "month", "year"))

aggregate_months_2019 <- fixing_2019_dates %>%
  group_by(month) %>%
  summarize(count = n())

write_csv(aggregate_months_2019,"month_by_month_2019.csv")

fixing_2020_dates <- georgia_lasers_2020 %>%
  clean_names()

fixing_2020_dates <- fixing_2020_dates %>%
  separate(incident_date, sep="-", into = c("day", "month", "year")) %>%
  group_by(month) %>%
  summarize(count = n())

write_csv(fixing_2020_dates,"month_by_month_2020.csv")

```

## Let's compare some figures to see where Georgia stands nationally


```{r}

lasers_2019 %>%
  group_by(State) %>%
  summarise(count = n()) %>%
  arrange(desc(count))

states_2020 <- lasers_2020 %>%
  group_by(State) %>%
  summarise(count = n()) %>%
  arrange(desc(count))

states_2021 <- lasers_2021 %>%
  group_by(State) %>%
  summarise(count = n()) %>%
  arrange(desc(count))

lasers_2022 %>%
  group_by(State) %>%
  summarise(count = n()) %>%
  arrange(desc(count))

states_2020_21 <- states_2020 %>% left_join(states_2021, by=c("State")) %>%
  rename(count_2020=count.x, count_2021=count.y) %>%
  mutate(`State` = case_when(
    `State` == "Miami" ~ "Florida",
    `State` == "North Hampshire" ~ "New Hampshire",
    TRUE ~ `State`
  )) %>%
  distinct()

write_csv(states_2020_21, "states_2020_2021.csv")

```



